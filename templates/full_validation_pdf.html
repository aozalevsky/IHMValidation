{% from "macro.html" import write_table, format_help with context %}
<!Template for writing HTML(minimal use of bootstrap) for PDF version of the report>
<! ganesans - Salilab - UCSF>
<!ganesans@salilab.org>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PDB-IHM Validation Report Landing Page</title>
    <!-- add bootstrap css file -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
       @charset "UTF-8";
       /* CSS Document */
       a {
       color: #333399;
       font-weight: 450;
       }
       a:hover {
       color:#5353c6;
       }
       .clearfloat { /* this class can be placed on a <br /> or empty div as the final element following the last floated div (within the #container) if the #footer is removed or taken out of the #container */
       clear:both;
       height:0;
       font-size: 1px;
       line-height: 0px;
       }
       .help2 {
       color:#fff;
       background-color:#228B22;
       width:20px;
       height:20px;
       display:inline-block;
       border-radius:100%;
       font-size:14px;
       text-align:center;
       text-decoration:Help;
       font-weight: 450;
       -webkit-box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       -moz-box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       }
       .help1 {
       color:#fff;
       background-color:#228B22;
       width:18px;
       height:18px;
       display:inline-block;
       border-radius:100%;
       font-size:16px;
       text-align:center;
       text-decoration:Help;
       font-weight: 450;
       -webkit-box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       -moz-box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       }
       .help1:hover {
       background-color: #eee;
       transition: all ease-in-out 0.2s;
       cursor: pointer;
       border: 1px solid #888;
       background-color: #ddd;
       color:#fff;
       background-color:#228B22;
       width:22px;
       height:22px;
       display:inline-block;
       border-radius:100%;
       font-size:18px;
       font-weight: 450;
       text-align:center;
       text-decoration:Help;
       -webkit-box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       -moz-box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       box-shadow: inset -1px -1px 1px 0px rgba(0,0,0,0.25);
       }
       body {
       background-color: #FFFFFF ;
       margin: 0;
       padding: 0;
       }
       .home-header {
       display: show;
       }
       .dropdown-submenu {
       }
       .dropdown-submenu a::after {
       transform: rotate(-90deg);
       position: absolute;
       right: 6px;
       top: .8em;
       }
       .dropdown-submenu .dropdown-menu {
       top: 0;
       left: 100%;
       margin-left: .1rem;
       margin-right: .1rem;
       }
       hr {
       width: 100%;
       height: 2px;
       margin-left: 10px;
       margin-right: 10px;
       background-color:#666;
       border: 0 none;
       margin-top: 10px;
       margin-bottom:10px;
       }

       table.table-bordered{
           border:1px solid black;
       }

       table.table-bordered th, table.table-bordered td {
           border:1px solid black;
           padding:0.25rem;
           text-align:center; 
           vertical-align: middle;
       }
      
       /* Some fixes for the representation table 
          because it can be very long */
       table.table-bordered .tdup {
           vertical-align: top;
       }

      thead { display: table-header-group; }
      tfoot { display: table-row-group; }
      tr { page-break-inside: avoid; }

    </style>
  </head>
  <!-- Body -->
  <body>
    <!-- Header and metadata --> 
    <div class="card-body border-success" style="border-color: solid black" align='center'>
      <div class="row">
        <div class="col-lg-12">
          <div class="card-header" style="background-color: #E4E4E4; min-height: 17rem;">
            <h1 align="center">Integrative Structure Validation Report
              {{ format_help("understanding", current_task) }}
            </h1>
            <p align="center" style="font-size: 2rem">{{ date }}</p>
            {% include 'validation_software.j2' %}
          </div>
        </div>
      </div>
    </div>
    
    <hr>
    
    <!-- Basic entry info: ID and authors -->
    <div class="card-body border-success" style="border-color: solid black;">
      <div class="row">
        <div>
          <div class="card-header" style="background-color: #FFFFFF;">
            <div class="bs-example" class="text-center">
              <table class="table table-bordered" style="height: 16rem;">
                {% for k, v in ranked_id_list %}
                  <tr>
                    <td style="text-align:center; vertical-align: middle; white-space:nowrap;">{{ k }}</td>
                    <td style="text-align:center; vertical-align: middle;">{{ v }}
                      <!-- Ad-hoc fix for extended PDB IDs -->
                      {% if k == "PDB ID" and v|length == 4 %}
                        | {{ PDB_ID }}
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
                <tr>
                  <td style="text-align:center; vertical-align: middle; white-space:nowrap;">Structure Title</td>
                  <td style="text-align:center; vertical-align: middle;">{{ Molecule }}</td>
                </tr>
                <tr>
                  <td style="text-align:center; vertical-align: middle; white-space:nowrap;">Structure Authors</td>
                  <td style="text-align:center; vertical-align: middle;">{{ Authors }}</td>
                </tr>
                <tr>
                  <td style="text-align:center; vertical-align: middle; white-space:nowrap;">Deposited on</td>
                  <td style="text-align:center; vertical-align: middle;">{{ deposition_date }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- RED PDB-IHM banner -->
    <div class="card-body border-success" style="border-color: solid black;">
      <div class="row">
        <div class="col-lg-8 col-md-2">
          <div class="card-header" style="background-color: #FF7F7F;">
            <div class="bs-example" class="text-center">
              <p align="center"><em>This is a PDB-IHM Structure Validation Report.</em></p>
              <p align="text-center" class="align-middle">
              <em>We welcome your comments at  <a href=mailto:helpdesk@pdb-ihm.org>helpdesk@pdb-ihm.org</a></em>
              </p>
              <p align="text-center" class="align-middle">
              <em>A user guide is available at  <a href=https://pdb-ihm.org/validation_help.html>https://pdb-ihm.org/validation_help.html</a> with specific help available everywhere you see the </em> <a class='help2' style='background-color:#228B22;color:#000000;text-decoration:none font-size=14px'>?</a> symbol.
              </p>
              <p align="text-center" class="align-middle">
                <em>List of references used to build this report is available  <a href='https://pdb-ihm.org/validation_help.html#references1'>here</a>.</em>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
   

    <!-- Overview -->
    <div class="card-body">
      <div class="row">
        <div class="col-lg-12">
          <div class="card-header" style="background-color: #FFFFFF; padding: 0px;">
            <h3 align="center">
              <a name='overview'><u>1. Overview</u></a> 
              {{ format_help("overview", current_task) }}
            </h3>
            
            <!-- Summary -->
            {% include 'summary.j2' %}
            
            <!-- Overall quality -->
            <h4 align="center">
              <a name='qual'><u>1.2. Overall quality</u></a> 
              {{ format_help("ataglance", current_task) }}
            </h4>
            
            <p align="justify">
            <em>This validation report contains model quality assessments for all structures, data quality and fit to model assessments for SAS and crosslinking-MS datasets. Data quality and fit to model assessments for other datasets and model uncertainty are under development. Number of plots is limited to {{MAXPLOTS}}.</em>
            </p>
            
            <!-- MolProbity or excluded volume -->
            <div class="box text-center container-fluid no-padding" align='center' style="break-inside: avoid;">
              {% if disclaimer == 0 %}
                {% if atomic and molprobity_models|length > 0 %}
                  <h5 align=center>
                    <u>Model Quality: MolProbity Analysis</u>
                    {{ format_help("molprobity", current_task) }}
                  </h5>
                
                  {% for i in range([molprobity_models|length, MAXPLOTS] | min) %}
                    <div>
                      <img src={{ "../images/" ~ ID_f ~ '_' ~ molprobity_models[i] ~ '_quality_at_glance_MQ_mp.svg'}}>
                      <p style=margin-bottom:1em;> </p>
                    </div>
                  {% endfor %}
                {% endif %}
                
                {% if cg and excluded_volume_models|length > 0 %}
                  <h5 align=center>
                    <u>Model Quality: Excluded Volume Analysis</u>
                    {{ format_help("exv", current_task) }}
                  </h5>
                
                  {% for i in range([excluded_volume_models|length, MAXPLOTS] | min) %}
                    <div>
                      <img src={{ "../images/" ~ ID_f ~ '_' ~ excluded_volume_models[i] ~ '_quality_at_glance_MQ_exv.svg'}}>
                      <!-- <p style=margin-bottom:1em;> </p> -->
                    </div>
                  {% endfor %}
                {% endif %}
              {% elif disclaimer == 1 %}
                <p align="justify">
                  <em>MolProbity assessments and/or excluded volume assessments can not be evaluated for this current model.</em>
                </p>
              {% endif %}
            </div>
  
            <!-- Data quality -->
            {% if glance_plots["DQ"] %}
              <h5 align=center style="margin-top: 2em">
                <u>Data Quality</u>
                {{ format_help("dataquality", current_task) }}
              </h5>
              <div class="box text-center container-fluid no-padding" align="center">
                <img src={{"../images/" ~ ID_f ~ '_' ~ "quality_at_glance_DQ.svg"}}>
              </div>
            {% endif %}
  
            <!-- Fit to data -->
            {% if glance_plots["FQ"] %}
              <h5 align=center style="margin-top: 2em">
                <u>Fit to Data Used for Modeling</u>
                {{ format_help("fittodata", current_task) }}
              </h5>
              <div class="box text-center container-fluid no-padding" align="center">
                <img src={{"../images/" ~ ID_f ~ '_' ~ "quality_at_glance_FQ.svg"}}>
              </div>
            {% endif %}

          </div>
        </div>
      </div>
    </div>
   
    <!-- Ensemble information -->
    <div class="card-body border-success" style="border-color: solid black;">
      <div class="row">
        <div class="col-lg-12">
          <div class="card-header" style="background-color: #FFF; padding: 0px;">
            <h3 align="center">
              <a name="#modeldetails"><u>2. Model Details</u></a>
              {{ format_help("modeldetails", current_task) }}
            </h3>
            
            <h4 align="center">
              <a name="ensemble"><u>2.1. Ensemble information</u></a>
              {{ format_help("ensemble", current_task) }}
            </h4>
            <p><i>This entry consists of {{ num_ensembles|int }} distinct ensemble(s).</i></p>
          
            {% include 'representation.j2' %} 
    
            <h4 align="center">
              <u><a name='data'>2.3. Datasets used for modeling</a></u>
              {{ format_help("datasets", current_task) }}
            </h4>
            
            <p>
              {% if number_of_datasets|int < 2 %}
                <i>There is {{ number_of_datasets|int }} unique dataset used to build the models in this entry.</i>
              {% else %}
                <i>There are {{ number_of_datasets|int }} unique datasets used to build the models in this entry.</i>
              {% endif %}
            </p>
            
            {{ write_table(Datasets_list) }}
            
            <h4 align="center">
              <u><a name="methods">2.4. Methodology and software</a></u> 
              {{ format_help("software", current_task) }}
            </h4>
            <p>
              <i>This entry is a result of {{ Protocols_number|int }} distinct protocol(s).</i>
            </p>

            {{ write_table(Sampling_list) }}

            {% if number_of_software|int < 1 %}
              <i>Software packages used for modeling were either not reported or not used.</i>
            {% elif number_of_software|int < 2 %}
              <i>There is {{ number_of_software|int }} software package reported in this entry.</i>
            {% else %}
              <i>There are {{ number_of_software }} software packages reported in this entry.</i>
            {% endif %} 
            
            {{ write_table(soft_list) }}

          </div>
        </div>
      </div>
    </div>
      
    <hr>
    
    <!-- Data quality -->
    <div class="card-header" style="background-color: #FFF;">
      <div class="row">
        <div class="col-lg-12">
          <h3 align="center">
             <u><a name='first'>3. Data quality</a></u> 
              {{ format_help("dataquality", current_task) }}
          </h3>
          
          <!-- SAS -->
          {% if ( sas ) and ( sasdb_sascif|length > 0 ) %}
            <h4 align="center">
              <u><a name='first'>3.1. SAS</a></u> 
              {{ format_help("dq-sas", current_task) }}
            </h4>
            <!-- Scattering profiles -->
            <h5 align=center>
              <u> <a name=firstI>3.1.1. Scattering profile</a> </u>
              {{ format_help("scattering", current_task) }}
            </h5>
            
            <p align=justify>
               SAS data used in this integrative model was obtained from {{ sasdb_code_html|length }} deposited SASBDB entry (entries).
            </p>
            
            {% for i in range ( sasdb_code_html|length ) %}
              <p align=justify>
                <u> Scattering profile for <a href=https://www.sasbdb.org/data/{{ sasdb_code_html[i] }}/>{{ sasdb_code_html[i] }}</a>:</u>
                data from solutions of biological macromolecules are presented as both log I(q) vs q and log I(q) vs log (q) based on
                <a href=https://salilab.org/pdf/Trewhella_ActaCrystD_2017.pdf>SAS validation task force (SASvtf) recommendations.</a>
                I(q) is the intensity (in arbitrary units) and q is the modulus of the scattering vector.
              </p>
              <div class=row>
                <div align=center>
                  <img src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_intensities.svg>
                  <img src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_intensities_log.svg>
                </div>
              </div>
              <p style=margin-bottom:0.5cm;></p>
            {% endfor %}

            <!-- Key experimental estimates -->
            <h5 align=center>
              <u><a name=firstE>3.1.2. Key experimental estimates</a></u>
              {{ format_help("expt", current_task) }}
            </h5>
            <p align='justify'>
              <u>Molecular weight (MW) estimates from experiments and analysis</u>:
              true molecular weight can be compared to the Porod estimate from scattering profiles.
            </p>
            
            {{ write_table(parameters_mw) }}
            
            <p>
              <u>Volume estimates from experiments and analysis</u>: estimated volume can be compared to Porod volume obtained from scattering profiles.
            </p>
            
            {{ write_table(parameters_volume) }}
            
            <!-- Flexibility analysis -->
            <h5 align=center>
              <u><a name=firstF>3.1.3. Flexibility analysis</a></u> 
              {{ format_help("flexibility", current_task) }}
            </h5>
            {% for i in range ( sasdb_code_html|length ) %}
              <p align=justify>
                <u>Flexibility analysis for {{ sasdb_code_html[i] }}</u>: In a Porod-Debye plot, a clear plateau is observed for globular (partial or fully folded) domains, whereas, fully unfolded domains are devoid of any discernable plateau. For details, refer to Figure 5 in <a href=https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3103662/>Rambo and Tainer, 2011</a>. In a Kratky plot, a parabolic shape is observed for globular (partial or fully folded) domains and a hyperbolic shape is observed for fully unfolded domains.
              </p>
              <div class=row>
                  <div align=center>
                    <img src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_porod.svg>
                    <img src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_kratky.svg>
                  </div>
              </div>
              <p style=margin-bottom:0.5cm;></p>
            {% endfor %}
            
            <!-- Pair-distance distribution analysis -->
            <h5 align=center>
              <u><a name=firstP>3.1.4. Pair-distance distribution analysis</a></u>
              {{ format_help("pofr", current_task) }}
            </h5>
            <p align='justify'>
              <u>P(r) analysis:</u> P(r) represents the distribution of distances between all pairs of atoms within the particle weighted by the respective electron densities. P(r) is the Fourier transform of I(s) (and vice versa). R<sub>g</sub> can be estimated from integrating the P(r) function. Agreement between the P(r) and Guinier-determined R<sub>g</sub> (table below) is a good measure of the self-consistency of the SAS profile. R<sub>g</sub> is a measure for the overall size of a macromolecule; e.g. a protein with a smaller R<sub>g</sub> is more compact than a protein with a larger R<sub>g</sub>, provided both have the same molecular weight (MW). The point where P(r) is decaying to zero is called D<sub>max</sub> and represents the maximum size of the particle.
            </p>

            {{ write_table(pddf_info) }}
            
            {% for i in range( sasdb_code_html|length ) %}
              <p align=justify>
                <u> P(r) for {{ sasdb_code_html[i] }}:</u> The value of P(r) should be zero beyond r=D<sub>max</sub>.
              </p>
              <div class=row>
                <div align=center>
                  <img style="vertical-align: top" src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_pddf.svg>
                  <img style="vertical-align: top" src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_pddf_int.svg>
                </div>
              </div>
              <p style=margin-bottom:0.5cm;></p>
            {% endfor %}
            
            <!-- Guinier analysis -->
            <h5 align= center>
              <u><a name=firstG>3.1.5. Guinier analysis </a></u>
              {{ format_help("guinier", current_task) }}
            </h5>
            
            <p align='justify'>
              <u>Guinier analysis:</u> agreement between the P(r) and Guinier-determined R<sub>g</sub> (table below) is a good measure of the self-consistency of the SAS profile. Molecular weight estimates can also be compared to Porod and sample molecular weights for consistency.
            </p>
           
            {{ write_table(rg_table) }}
            
            <p align=justify>
              <u>Guinier analysis:</u> the linearity of the Guinier plot is a sensitive indicator of the quality of the experimental SAS data; a linear Guinier plot is a necessary but not sufficient demonstration that a solution contains monodisperse particles of the same size. Deviations from linearity usually point to strong interference effects, polydispersity of the samples or improper background subtraction. Residual value plot and coefficient of determination (R<sup>2</sup>) are measures to assess linear fit to the data. A perfect fit has an R<sup>2</sup> value of 1. Residual values should be equally and randomly spaced around the horizontal axis.
            </p>
            <div class=row align=center>
              {% for i in range(sasdb_code_html|length) %}
                <img src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] }}_guinier.svg>
              {% endfor %}
            </div>
            
          {% elif sas and (sasdb_sascif|length < 1) %}
            <h5 align=center>
              <u><a name=firstI>3.1.1. Scattering profile</a></u>
            </h5>
            
            <p align=justify>
              SAS data used in this integrative model could not be validated as the sascif file is currently unavailable.
            </p>
          {% endif %}
 
          <!-- crosslinking MS data validation --> 
          {% include 'cx_data_quality.j2' %}
          
          <!-- 3DEM data validation -->
          {% include 'em_data_quality.j2' %}
          
          <!-- Other datasets -->
          {% for i in range(Unique_dataset|length) %}
            <h4 align=center>
              <u><a name=last>3.4. {{ Unique_dataset[i] }}</a></u>
              {{ format_help("dq-other", current_task) }}
            </h4>
            <p align=justify>
              Validation for this section is under development.
            </p>
          {% endfor %}
        </div>
      </div>
    </div>
       
    <hr>
   
    {% include 'model_quality.j2' %}

    <hr>
    
    <!-- Fit to data used for modeling -->
    <div class="card-body border-success" style="border-color: solid black;">
      <div class="card-header" style="background-color: #FFF; padding: 0px;">
        <div class="row">
          <div class="col-lg-12">
            <h3 align="center">
              <u><a name='first'>5. Fit to Data Used for Modeling Assessment</a></u> 
              {{ format_help("fittodata", current_task) }}
            </h3>

            {% if sas %}
              {% if sasdb_sascif|length > 0 %}
                <h4 align=center>
                  <u>5.1. SAS</u>
                  {{ format_help("fq-sas", current_task) }}
                </h4>
                
                <h5 align=center>
                  <u>5.1.1 χ² goodness of fit and 5.1.2 cormap analysis</u> 
                  {{ format_help("goodness", current_task) }}
                </h5>
                
                {% if number_of_fits  > 0 %}
                  <p>
                    <i>Model and fits displayed below were obtained from SASBDB. χ² values are a measure of fit of the model to data. A perfect fit has a χ² value of 1.0. 
                      ATSAS DATCMP was used for hypothesis testing. All data sets are similar (i.e. the fit and the data collected) is the null hypothesis. p-value is a measure of evidence against the null hypothesis, smaller the value, the stronger the evidence that you should reject the null hypothesis.
                    </i>
                  </p>

                  {{ write_table(p_val) }}
                  <p align=justify align=center>
                    <u>Model fit(s):</u> Residual value plot is a measure to assess fit to the data. Residual values should be equally and randomly spaced around the horizontal axis. 
                  </p>
          
                  <div class=row>
                    <div align=center>
                      {% for i in range(sasdb_code_html|length) %}
                        {% for j in range(sasdb_code_fits[i]) %}
                          {% set k = j + 1 %}
                            <img src=../images/{{ ID_f ~ '_' ~ sasdb_code_html[i] ~ '_' ~ j|int }}_fit1.svg>
                        {% endfor %}
                      {% endfor %}
                    </div>
                  </div>
                {% else %}
                  <p>
                    <i>Model(s) and/or fit for this entry have not been deposited.</i>
                  </p>
                {% endif %}
              {% else %}
                <p align=justify>
                  SAS data used in this integrative model could not be validated as the sascif file is currently unavailable.
                </p>
              {% endif %}
              <p style=margin-bottom:0.5cm;> </p>                                                                                                                                                                                                    
            {% endif %}

            {% if cx %}
              <h4 align=center id="cxms">
                <u>5.2. Crosslinking-MS</u>
                {{ format_help("fq-crosslinking-ms", current_task) }}
              </h4>

              <h5 align=center id="cxms_ertypes">
                <u>5.2.1. Restraint types</u>
                {{ format_help("fq-crosslinking-ms-restraints", current_task) }}
              </h5>
              
              {% if cx_ertypes is none %}
                <p>Restraint types in this entry are not supported at the moment.</p>
              {% else %}
                <div class="row">
                  <div class='col-lg-12'>
                    <p>
                      <i>
                        Restraint types are summarized in the table below. 
                        Restraints assigned "<a href=https://mmcif.wwpdb.org/dictionaries/mmcif_ihm_ext.dic/Items/_ihm_cross_link_restraint.model_granularity.html>by-residue</a>" are interpreted as between CA atoms. 
                        Restraints between coarse-grained beads are indicated as "coarse-grained". <a href=https://mmcif.wwpdb.org/dictionaries/mmcif_ihm_ext.dic/Items/_ihm_cross_link_restraint.group_id.html>Restraint group</a> represents a set of crosslinking restraints applied collectively in the modeling.
                      </i>
                    </p>
                    <p>
                      There are {{ cx_num_of_restraints }} crosslinking restraints 
                      combined in {{ cx_num_of_restraint_groups }} restraint groups. 
                    </p>
                    <div class='text-center'>
                      <table id='cx_ertypes_table' class='table table-sm table-bordered' style='border-color':#003366;>
                        <thead>
                          <tr>
                            {% for k in cx_ertypes['columns'] %}
                            <th align='center' class='text-center' style='vertical-align:middle'>
                              {{ k }}
                            </th>
                            {% endfor %}
                          </tr>
                        </thead>
                        
                        {% for i in range(cx_ertypes['data']|length) %}
                          <tr>
                            {% for v in cx_ertypes['data'][i] %}
                              <td>{{ v }}</td>
                            {% endfor %}
                          </tr>
                        {% endfor %}
                      </table>
                    </div>
                  </div>
                  <div class=col-lg-12>
                    <div text-center container-fluid no-padding align=center>
                      <div>
                        <p><u>Distograms of individual restraints</u></p>
                      </div>
                      {% if cx_stats is none %}
                        <p>Distograms for this entry are unavailable the moment.</p>
                      {% else %}
                        <p style='text-align: left'>
                          <i>Restraints with identical thresholds are grouped into one plot. 
                            Only the best distance per restraint per model group/ensemble is plotted. 
                            Inter- and intramolecular (including self-links) restraints are also grouped into one plot.
                            Distance for a restraint between coarse-grained beads is calculated as a minimal distance 
                            between shells; if beads intersect, the distance will be reported as 0.0. 
                            A bead with the highest available resolution for a given residue is used for the assessment.
                          </i>
                        </p>
                        {% for i in range(cx_distograms_plots_svg|length) %}
                          <img id='cx_distograms_plot_{{ i }}' src='../images/{{ cx_distograms_plots_svg[i] }}'>
                        {% endfor %}
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endif %}
              <p style=margin-bottom:1em;> </p>
              <!-- end of cx_ertypes --> 
              
              <h5 align=center id="cxms_satisfaction">
                <u>5.2.2. Satisfaction of restraints</u>
                {{ format_help("fq-crosslinking-ms-satisfaction", current_task) }}
              </h5>
              
              {% if cx_stats is none %}
                <p>Satisfaction rates for this entry are unavailable at the moment.</p>
              {% else %}
                <div class=row>
                  <div class=col-lg-12>
                    <p>
                      <i>
                        Satisfaction of restraints is calculated on a <a href=https://mmcif.wwpdb.org/dictionaries/mmcif_ihm_ext.dic/Items/_ihm_cross_link_restraint.group_id.html>restraint 
                        group</a> (a set of crosslinking restraints applied collectively in the modeling) level. Satisfaction of a restraint group depends on 
                        satisfaction of individual restraints in the group and the 
                        conditionality (all/any). A restraint group is considered 
                        satisfied, if the condition was met in at least one model of 
                        the model group/ensemble. The number of measured restraints 
                        can be smaller than the total number of restraint groups if 
                        crosslinks involve non-modeled residues. 
                        Only deposited models are used for validation right now.
                      </i>
                    </p>
                  
                    <div class='table-responsive text-center'>
                      <table id='cx_satisfaction_table' class='table table-sm table-bordered' style='border-color':#003366;>
                        <thead>
                          <tr>
                            <th>
                              State group
                            </th>
                            <th>
                              State
                            </th>
                            <th>
                              Model group
                            </th>
                            <th>
                              # of Deposited models/Total
                            </th>
                            <th>
                              Restraint group type
                            </th>
                            <th>
                              Satisfied (%)
                            </th>
                            <th>
                              Violated (%)
                            </th>
                            <th>
                              Count (Total={{ cx_num_of_restraint_groups }})
                            </th>
                          </tr>
                        </thead>
                        {% for sg, sgv in cx_stats.items() %}
                          {% set state_group_loop = loop %}
                          {% for st, stv in sgv.items() %}
                            {% for mg, mgv in stv.items() %}
                              {% for k, v in mgv["cx_stats"].items() %}
                              {% set rowspan = mgv["cx_stats"]|length %}
                                <tr>
                                  {% if loop.index == 1 %}
                                    <td rowspan={{ rowspan }}>{{ sg }}</td>
                                    <td rowspan={{ rowspan }}>{{ st }}</td>
                                    <td rowspan={{ rowspan }}>{{ mg }}</td>
                                    <td rowspan={{ rowspan }}>{{ mgv["ens_stats"]["num_models_deposited"] ~ "/" ~ mgv["ens_stats"]["num_models"]}}</td>
                                  {% endif %}
                                  <td>{{ k | replace("/", "/<br>")}}</td>
                                  <td>{{ v["Satisfied"] }}</td>
                                  <td>{{ v["Violated"] }}</td>
                                  <td style='horizontal-align:right'>{{ v["Count"] }}</td>
                                </tr>
                              {% endfor %}
                            {% endfor %}
                          {% endfor %}
                        {% endfor %}
                      </table>
                    </div>
                  </div>
                  <div class=col-lg-12>
                    <div text-center container-fluid no-padding align=center>
                      <p><u>Per-model satisfaction rates in ensembles</u></p>
                      <p style="text-align: left"><i>Every point represents one model in a model group/ensemble. Where possible, boxplots with quartile marks are also plotted.</i></p>
                      {% for i in range(cx_satisfaction_plots_svg|length) %}
                        <img id='cx_satisfaction_plot_{{ i }}' src='../images/{{ cx_satisfaction_plots_svg[i] }}'>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              <!-- end of cx_stats --> 
              {% endif %}
              <p style=margin-bottom:0.5cm;> </p>
            <!-- end of cx --> 
            {% endif %}

            {% include "em_fit.j2" %}
                
            {% for i in range(Unique_dataset|length) %}
              <h4 align= center>
                <u><a name=last>5.4. {{ Unique_dataset[i] }}</a></u>
                {{ format_help("fq-other", current_task) }}
              </h4>
              <p align=justify>
                Validation for this section is under development.
              </p>
            
              <p style=margin-bottom:0.5cm;> </p>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
      
    <hr>
    
    <!-- Fit to data used for validation -->
    <div class="card-body border-success" style="border-color: solid black;">
      <div class="card-header" style="background-color: #FFF; padding: 0px;">
        <div class="row">
          <div class="col-lg-12">
            <h3 align="center">
              <u><a name='first'>6. Fit to Data Used for Validation Assessment</a></u>
              {{ format_help("fittoval", current_task) }}
            </h3>
            <p align=justify>
              Validation for this section is under development.
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <hr>
    
    <!-- Footer -->
    <div class="card-body border-success" style="border-color: solid black;">
      <div class="row">
        <div class="col-lg-12">
          {% include 'acknowledgments.j2' %}
        </div>
      </div>
    </div>
  </body>
</html>
